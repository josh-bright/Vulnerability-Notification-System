# Import modules
import requests
import json

# Define JSON formatted print function
def jprint(obj):
    # create a formatted string of the Python JSON object
    text = json.dumps(obj, sort_keys=True, indent=4)
    print(text)

# Define JSON formatted write function
def jwrite(obj):
    # create a formatted string of the Python JSON object
    text = json.dumps(obj, sort_keys=True, indent=4)
    file = open('outputfile.txt', 'a')
    file.write(text)

# Define API call parameters
cveId = "CVE-2017-0144"
cpeMatchString = "cpe:2.3:a:microsoft:exchange_server:2013:"
cves = True

# Concatenate query string
queryString = "cpeMatchString=" + cpeMatchString + "&cves=" + str(cves)

response = requests.get("https://services.nvd.nist.gov/rest/json/cves/1.0?" + queryString)
data = response.json() if response and response.status_code == 200 else None
if data and 'result' in data:
    if 'CVE_Items' in data['result']:
        if 'cve' in data['result']['CVE_Items']:
            if 'CVE_data_meta' in data['result']['CVE_Items']['cve']:
                for CVE_data_meta in data['result']['CVE_Items']['cve']['CVE_data_meta']:
                    cve_id = CVE_data_meta.get('ID')
            else:
                print("FAILED - 4")
        else:
            print("FAILED - 3")
    else:
        print("FAILED - 2")
else:
    print("FAILED - 1")

print(data['result']['CVE_Items']['cve'])

# Open JSON

#jprint(response.json())
#jwrite(response.json())

#print(responseConverted['result']['CVE_Items']['cve'])

